<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>

</head>
<!--all suggestions are returned in queryResults on load to be iterated through for the left column-->
<body onload="getSuggestions()">

    <!--i added this button to show how the function works to get info for a suggestion so you can display it on the right column-->
    <button onclick="getInfo(testTitle)">Click Here!</button>




    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
        //i hardcoded this for the button to show how it works this var can be removed
        var testTitle = "UserID Test";

        var queryResults = "";
        var infoResults = "";

        //function to return all suggestions, runs automatically on load
        function getSuggestions() {


            var webMethod = "ProjectServices.asmx/AllSuggestionQuery";


            //jQuery ajax method
            $.ajax({

                type: "POST",
                url: webMethod,
                contentType: "application/json; charset=utf-8",
                dataType: "json",

                success: function (data) {
                    suggestionList = data;
                    queryResults = JSON.parse(suggestionList.d);

                    let text = "<div>"
                    for (var x = 0; x < queryResults.length; x++) {
                        text += "<button class=suggestionButton>" + queryResults[x].Title + "</button>" + "<br>" + "<br>";
                    }
                    text += "</div>";

                    document.getElementById('suggestionList').innerHTML = text;

                    var allElements = document.getElementsByClassName("suggestionButton");
                    for (var x = 0; x < allElements.length; x++) {
                        allElements[x].id = x;
                    }

                    for (var x = 0; x < allElements.length; x++) {
                        document.getElementById(x).setAttribute("onclick", `getInfo("${queryResults[x].Title}")`)
                    }

                },
                error: function (e) {
                    alert("An error occured");
                }
            });

        }


        //this function returns the suggestion details in JSON, you need to pass the suggestion title in parameter
        function getInfo(Title) {


            var webMethod = "ProjectServices.asmx/GetSuggestionInfo";
            var parameters = "{\"Title\":\"" + encodeURI(Title) + "\"}";

            //jQuery ajax method
            $.ajax({

                type: "POST",
                url: webMethod,
                data: parameters,
                contentType: "application/json; charset=utf-8",
                dataType: "json",

                success: function (data) {
                    suggestionList = data;
                    infoResults = JSON.parse(suggestionList.d);

                    let p = "<div>";
                    let x = 0;
                    p += "<p>" + "Title: " + infoResults[x].Title + "</p>" + "<br>" + "<br>" +
                        "<p>" + "Department: " + infoResults[x].Department + "</p>" + "<br>" + "<br>" +
                        "<p>" + "Suggestion:" + "<br>" + infoResults[x].SuggestionBody + "</p>" + "<br>" + "<br>" +
                        "<p id=status>" + "Status: " + infoResults[x].Status + "</p>" + "<br>" + "<br>" +
                        "<p>" + "From: " + infoResults[x].UserID + "</p>" + "</div>"

                    x += 1;
                    document.getElementById('suggestionContent').innerHTML = p;   
                },
                error: function (e) {
                    alert("An error occured");
                }
            });

        }
    </script>
    <style>
        .col-01 { width:   8.33%; }
		.col-02 { width:  16.66%; }
		.col-03 { width:  25.00%; }
		.col-04 { width:  33.33%; }
		.col-05 { width:  41.66%; }
		.col-06 { width:  50.00%; }
		.col-07 { width:  58.33%; }
		.col-08 { width:  66.66%; }
		.col-09 { width:  75.00%; }
		.col-10 { width:  83.33%; }
		.col-11 { width:  91.66%; }
		.col-12 { width: 100.00%; }

		[class*="col-"] {
			float: 		left;
			padding: 	2vh;
			border: 	0.5vh solid white;
		}

		.row::after {
			content: 	"";
			clear: 		both;
			display: 	block;
		}

        .blue { background-color: #77b8ec }
		.purple { background-color: #e974bc; }
		.tea { background-color: rgb(16, 74, 235); }

    </style>

    <div class="row">
        <div class="col-10 headHeight">
            <h1>Community Suggestion</h1>
        </div>
        <div class="col-2 headHeight">
            <a href="./homepage.html">Home</a>
        </div>
    </div>

    <div class="row">
        <div class="col-6 headHeight">

        </div>
        <div class="col-6 headHeight">

        </div>
    </div>
</body>
</html>